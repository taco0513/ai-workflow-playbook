<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Builder - 드래그 앤 드롭 앱 빌더</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            height: 100vh;
            overflow: hidden;
        }

        /* 헤더 */
        .header {
            background: #2c3e50;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .logo {
            font-size: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        /* 메인 레이아웃 */
        .main-container {
            display: flex;
            height: calc(100vh - 60px);
        }

        /* 컴포넌트 라이브러리 */
        .component-library {
            width: 250px;
            background: white;
            border-right: 1px solid #ddd;
            overflow-y: auto;
            padding: 20px;
        }

        .component-category {
            margin-bottom: 20px;
        }

        .category-title {
            font-weight: bold;
            color: #34495e;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .component-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 8px;
            cursor: move;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .component-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .component-icon {
            font-size: 20px;
        }

        /* 캔버스 */
        .canvas-container {
            flex: 1;
            background: #fff;
            position: relative;
            overflow: auto;
        }

        .canvas {
            min-height: 100%;
            padding: 20px;
            position: relative;
        }

        .drop-zone {
            border: 2px dashed #bdc3c7;
            border-radius: 8px;
            min-height: 100px;
            margin: 10px;
            padding: 20px;
            text-align: center;
            color: #95a5a6;
            transition: all 0.3s;
        }

        .drop-zone.drag-over {
            border-color: #3498db;
            background: #ecf0f1;
        }

        .dropped-component {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
            margin: 10px;
            position: relative;
            cursor: move;
        }

        .dropped-component:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .dropped-component.selected {
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.3);
        }

        /* 속성 패널 */
        .properties-panel {
            width: 300px;
            background: white;
            border-left: 1px solid #ddd;
            padding: 20px;
            overflow-y: auto;
        }

        .property-group {
            margin-bottom: 20px;
        }

        .property-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .property-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .property-select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 10px;
            background: white;
        }

        /* 실시간 프리뷰 */
        .preview-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 12px 24px;
            border-radius: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
        }

        /* 코드 모달 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
        }

        .modal-content {
            background: white;
            width: 80%;
            max-width: 800px;
            margin: 50px auto;
            border-radius: 8px;
            padding: 30px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .code-output {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            overflow-x: auto;
        }

        /* 컴포넌트 스타일 */
        .component-button {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        .component-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .component-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .component-text {
            font-size: 16px;
            line-height: 1.5;
            color: #333;
        }

        .component-heading {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- 헤더 -->
    <div class="header">
        <div class="logo">
            <span>🎨</span>
            <span>Visual Builder</span>
        </div>
        <div class="actions">
            <button class="btn btn-secondary" onclick="clearCanvas()">초기화</button>
            <button class="btn btn-primary" onclick="generateCode()">코드 생성</button>
        </div>
    </div>

    <!-- 메인 컨테이너 -->
    <div class="main-container">
        <!-- 컴포넌트 라이브러리 -->
        <div class="component-library">
            <div class="component-category">
                <div class="category-title">기본 요소</div>
                <div class="component-item" draggable="true" data-component="heading">
                    <span class="component-icon">📝</span>
                    <span>제목</span>
                </div>
                <div class="component-item" draggable="true" data-component="text">
                    <span class="component-icon">📄</span>
                    <span>텍스트</span>
                </div>
                <div class="component-item" draggable="true" data-component="button">
                    <span class="component-icon">🔘</span>
                    <span>버튼</span>
                </div>
                <div class="component-item" draggable="true" data-component="input">
                    <span class="component-icon">📝</span>
                    <span>입력 필드</span>
                </div>
            </div>

            <div class="component-category">
                <div class="category-title">레이아웃</div>
                <div class="component-item" draggable="true" data-component="card">
                    <span class="component-icon">🎴</span>
                    <span>카드</span>
                </div>
                <div class="component-item" draggable="true" data-component="container">
                    <span class="component-icon">📦</span>
                    <span>컨테이너</span>
                </div>
            </div>

            <div class="component-category">
                <div class="category-title">미디어</div>
                <div class="component-item" draggable="true" data-component="image">
                    <span class="component-icon">🖼️</span>
                    <span>이미지</span>
                </div>
                <div class="component-item" draggable="true" data-component="video">
                    <span class="component-icon">🎥</span>
                    <span>비디오</span>
                </div>
            </div>
        </div>

        <!-- 캔버스 -->
        <div class="canvas-container">
            <div class="canvas" id="canvas">
                <div class="drop-zone" id="dropZone">
                    컴포넌트를 여기에 드래그하세요
                </div>
            </div>
        </div>

        <!-- 속성 패널 -->
        <div class="properties-panel" id="propertiesPanel">
            <h3>속성 패널</h3>
            <p style="color: #95a5a6; margin-top: 10px;">컴포넌트를 선택하세요</p>
        </div>
    </div>

    <!-- 프리뷰 토글 -->
    <div class="preview-toggle" onclick="togglePreview()">
        👁️ 미리보기
    </div>

    <!-- 코드 생성 모달 -->
    <div class="modal" id="codeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>생성된 코드</h2>
                <button class="btn btn-secondary" onclick="closeModal()">닫기</button>
            </div>
            <div>
                <select class="property-select" onchange="changeCodeFormat(this.value)">
                    <option value="html">HTML</option>
                    <option value="react">React</option>
                    <option value="vue">Vue</option>
                </select>
            </div>
            <div class="code-output" id="codeOutput"></div>
        </div>
    </div>

    <script>
        let selectedComponent = null;
        let componentId = 0;
        let components = [];

        // 컴포넌트 템플릿
        const componentTemplates = {
            heading: {
                html: '<h1 class="component-heading">제목을 입력하세요</h1>',
                properties: {
                    text: '제목을 입력하세요',
                    size: 'h1',
                    color: '#2c3e50'
                }
            },
            text: {
                html: '<p class="component-text">텍스트를 입력하세요</p>',
                properties: {
                    text: '텍스트를 입력하세요',
                    fontSize: '16px',
                    color: '#333'
                }
            },
            button: {
                html: '<button class="component-button">버튼</button>',
                properties: {
                    text: '버튼',
                    backgroundColor: '#3498db',
                    color: '#fff'
                }
            },
            input: {
                html: '<input class="component-input" placeholder="입력하세요">',
                properties: {
                    placeholder: '입력하세요',
                    type: 'text'
                }
            },
            card: {
                html: '<div class="component-card"><h3>카드 제목</h3><p>카드 내용</p></div>',
                properties: {
                    title: '카드 제목',
                    content: '카드 내용'
                }
            },
            container: {
                html: '<div style="border: 1px dashed #ccc; padding: 20px; min-height: 100px;">컨테이너</div>',
                properties: {
                    padding: '20px',
                    backgroundColor: 'transparent'
                }
            },
            image: {
                html: '<img src="https://via.placeholder.com/300x200" style="max-width: 100%;">',
                properties: {
                    src: 'https://via.placeholder.com/300x200',
                    alt: '이미지'
                }
            },
            video: {
                html: '<video controls style="max-width: 100%;"><source src="movie.mp4" type="video/mp4"></video>',
                properties: {
                    src: 'movie.mp4'
                }
            }
        };

        // 드래그 앤 드롭 이벤트
        document.querySelectorAll('.component-item').forEach(item => {
            item.addEventListener('dragstart', handleDragStart);
        });

        const dropZone = document.getElementById('dropZone');
        const canvas = document.getElementById('canvas');

        dropZone.addEventListener('dragover', handleDragOver);
        dropZone.addEventListener('drop', handleDrop);
        dropZone.addEventListener('dragleave', handleDragLeave);

        function handleDragStart(e) {
            e.dataTransfer.effectAllowed = 'copy';
            e.dataTransfer.setData('component', e.target.getAttribute('data-component'));
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';
            dropZone.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            dropZone.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            
            const componentType = e.dataTransfer.getData('component');
            addComponent(componentType);
            
            // 첫 번째 컴포넌트 추가 시 drop zone 숨기기
            if (components.length === 1) {
                dropZone.style.display = 'none';
            }
        }

        function addComponent(type) {
            const template = componentTemplates[type];
            if (!template) return;

            const componentWrapper = document.createElement('div');
            componentWrapper.className = 'dropped-component';
            componentWrapper.innerHTML = template.html;
            componentWrapper.id = `component-${componentId}`;
            componentWrapper.onclick = () => selectComponent(componentWrapper, type);
            
            // 컴포넌트 데이터 저장
            components.push({
                id: componentId,
                type: type,
                properties: {...template.properties}
            });
            
            componentId++;
            canvas.appendChild(componentWrapper);
        }

        function selectComponent(element, type) {
            // 이전 선택 해제
            document.querySelectorAll('.dropped-component').forEach(comp => {
                comp.classList.remove('selected');
            });
            
            // 새 선택
            element.classList.add('selected');
            selectedComponent = element;
            
            // 속성 패널 업데이트
            showProperties(element.id, type);
        }

        function showProperties(componentId, type) {
            const component = components.find(c => c.id === parseInt(componentId.split('-')[1]));
            if (!component) return;

            const panel = document.getElementById('propertiesPanel');
            let html = '<h3>속성 패널</h3>';
            
            // 컴포넌트 타입별 속성 표시
            switch(type) {
                case 'heading':
                case 'text':
                    html += `
                        <div class="property-group">
                            <div class="property-label">텍스트</div>
                            <input class="property-input" type="text" value="${component.properties.text}" 
                                   onchange="updateProperty('${componentId}', 'text', this.value)">
                        </div>
                    `;
                    break;
                case 'button':
                    html += `
                        <div class="property-group">
                            <div class="property-label">버튼 텍스트</div>
                            <input class="property-input" type="text" value="${component.properties.text}" 
                                   onchange="updateProperty('${componentId}', 'text', this.value)">
                        </div>
                        <div class="property-group">
                            <div class="property-label">배경색</div>
                            <input class="property-input" type="color" value="${component.properties.backgroundColor}" 
                                   onchange="updateProperty('${componentId}', 'backgroundColor', this.value)">
                        </div>
                    `;
                    break;
                case 'input':
                    html += `
                        <div class="property-group">
                            <div class="property-label">플레이스홀더</div>
                            <input class="property-input" type="text" value="${component.properties.placeholder}" 
                                   onchange="updateProperty('${componentId}', 'placeholder', this.value)">
                        </div>
                    `;
                    break;
                case 'image':
                    html += `
                        <div class="property-group">
                            <div class="property-label">이미지 URL</div>
                            <input class="property-input" type="text" value="${component.properties.src}" 
                                   onchange="updateProperty('${componentId}', 'src', this.value)">
                        </div>
                    `;
                    break;
            }
            
            panel.innerHTML = html;
        }

        function updateProperty(componentId, property, value) {
            const element = document.getElementById(componentId);
            const component = components.find(c => c.id === parseInt(componentId.split('-')[1]));
            if (!element || !component) return;

            component.properties[property] = value;

            // DOM 업데이트
            switch(component.type) {
                case 'heading':
                case 'text':
                    element.querySelector('h1, p').textContent = value;
                    break;
                case 'button':
                    if (property === 'text') {
                        element.querySelector('button').textContent = value;
                    } else if (property === 'backgroundColor') {
                        element.querySelector('button').style.backgroundColor = value;
                    }
                    break;
                case 'input':
                    element.querySelector('input').placeholder = value;
                    break;
                case 'image':
                    element.querySelector('img').src = value;
                    break;
            }
        }

        function clearCanvas() {
            if (confirm('캔버스를 초기화하시겠습니까?')) {
                canvas.innerHTML = '<div class="drop-zone" id="dropZone">컴포넌트를 여기에 드래그하세요</div>';
                components = [];
                componentId = 0;
                document.getElementById('propertiesPanel').innerHTML = 
                    '<h3>속성 패널</h3><p style="color: #95a5a6; margin-top: 10px;">컴포넌트를 선택하세요</p>';
            }
        }

        function generateCode() {
            const modal = document.getElementById('codeModal');
            modal.style.display = 'block';
            changeCodeFormat('html');
        }

        function changeCodeFormat(format) {
            const output = document.getElementById('codeOutput');
            let code = '';

            switch(format) {
                case 'html':
                    code = generateHTMLCode();
                    break;
                case 'react':
                    code = generateReactCode();
                    break;
                case 'vue':
                    code = generateVueCode();
                    break;
            }

            output.textContent = code;
        }

        function generateHTMLCode() {
            let html = `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generated App</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .component-heading { color: #2c3e50; }
        .component-button { background: #3498db; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        .component-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .component-card { background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; }
    </style>
</head>
<body>
`;

            components.forEach(comp => {
                switch(comp.type) {
                    case 'heading':
                        html += `    <h1 class="component-heading">${comp.properties.text}</h1>\n`;
                        break;
                    case 'text':
                        html += `    <p>${comp.properties.text}</p>\n`;
                        break;
                    case 'button':
                        html += `    <button class="component-button" style="background-color: ${comp.properties.backgroundColor}">${comp.properties.text}</button>\n`;
                        break;
                    case 'input':
                        html += `    <input type="text" class="component-input" placeholder="${comp.properties.placeholder}">\n`;
                        break;
                    case 'image':
                        html += `    <img src="${comp.properties.src}" alt="${comp.properties.alt || 'Image'}" style="max-width: 100%;">\n`;
                        break;
                    case 'card':
                        html += `    <div class="component-card">\n        <h3>${comp.properties.title}</h3>\n        <p>${comp.properties.content}</p>\n    </div>\n`;
                        break;
                }
            });

            html += `</body>
</html>`;
            return html;
        }

        function generateReactCode() {
            let code = `import React from 'react';
import './App.css';

function App() {
    return (
        <div className="App">
`;

            components.forEach(comp => {
                switch(comp.type) {
                    case 'heading':
                        code += `            <h1 className="component-heading">${comp.properties.text}</h1>\n`;
                        break;
                    case 'text':
                        code += `            <p>${comp.properties.text}</p>\n`;
                        break;
                    case 'button':
                        code += `            <button className="component-button" style={{backgroundColor: '${comp.properties.backgroundColor}'}}>${comp.properties.text}</button>\n`;
                        break;
                    case 'input':
                        code += `            <input type="text" className="component-input" placeholder="${comp.properties.placeholder}" />\n`;
                        break;
                    case 'image':
                        code += `            <img src="${comp.properties.src}" alt="${comp.properties.alt || 'Image'}" style={{maxWidth: '100%'}} />\n`;
                        break;
                    case 'card':
                        code += `            <div className="component-card">\n                <h3>${comp.properties.title}</h3>\n                <p>${comp.properties.content}</p>\n            </div>\n`;
                        break;
                }
            });

            code += `        </div>
    );
}

export default App;`;
            return code;
        }

        function generateVueCode() {
            let template = `<template>
    <div id="app">
`;

            components.forEach(comp => {
                switch(comp.type) {
                    case 'heading':
                        template += `        <h1 class="component-heading">{{ heading }}</h1>\n`;
                        break;
                    case 'text':
                        template += `        <p>{{ text }}</p>\n`;
                        break;
                    case 'button':
                        template += `        <button class="component-button" :style="{backgroundColor: buttonColor}">{{ buttonText }}</button>\n`;
                        break;
                    case 'input':
                        template += `        <input type="text" class="component-input" :placeholder="placeholder" />\n`;
                        break;
                    case 'image':
                        template += `        <img :src="imageSrc" alt="Image" style="max-width: 100%;" />\n`;
                        break;
                    case 'card':
                        template += `        <div class="component-card">\n            <h3>{{ cardTitle }}</h3>\n            <p>{{ cardContent }}</p>\n        </div>\n`;
                        break;
                }
            });

            template += `    </div>
</template>

<script>
export default {
    name: 'App',
    data() {
        return {
`;

            // Vue data properties
            const dataProps = [];
            components.forEach((comp, index) => {
                switch(comp.type) {
                    case 'heading':
                        dataProps.push(`            heading: '${comp.properties.text}'`);
                        break;
                    case 'text':
                        dataProps.push(`            text: '${comp.properties.text}'`);
                        break;
                    case 'button':
                        dataProps.push(`            buttonText: '${comp.properties.text}'`);
                        dataProps.push(`            buttonColor: '${comp.properties.backgroundColor}'`);
                        break;
                    case 'input':
                        dataProps.push(`            placeholder: '${comp.properties.placeholder}'`);
                        break;
                    case 'image':
                        dataProps.push(`            imageSrc: '${comp.properties.src}'`);
                        break;
                    case 'card':
                        dataProps.push(`            cardTitle: '${comp.properties.title}'`);
                        dataProps.push(`            cardContent: '${comp.properties.content}'`);
                        break;
                }
            });

            template += dataProps.join(',\n');
            template += `
        }
    }
}
</script>`;

            return template;
        }

        function closeModal() {
            document.getElementById('codeModal').style.display = 'none';
        }

        function togglePreview() {
            alert('미리보기 기능은 다음 버전에서 제공될 예정입니다!');
        }

        // 모달 외부 클릭 시 닫기
        window.onclick = function(event) {
            const modal = document.getElementById('codeModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>